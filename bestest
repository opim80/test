-- 1. Load the Library
local syde = loadstring(game:HttpGet("https://raw.githubusercontent.com/essencejs/syde/main/source.lua"))()

-- 2. Services
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local RunService = game:GetService("RunService")

-- 3. Config & Constants
local SERVER_LOG_FILE = "syde_server_history.json"
local MESH_ID_TARGET = "rbxassetid://12439777368"
local LOG_EXPIRY_TIME = 1800 -- 30 minutes

-- 4. Server History Helpers
local function getHistory()
    if isfile(SERVER_LOG_FILE) then
        local success, data = pcall(function() return HttpService:JSONDecode(readfile(SERVER_LOG_FILE)) end)
        return success and data or {}
    end
    return {}
end

local function saveHistory(history)
    writefile(SERVER_LOG_FILE, HttpService:JSONEncode(history))
end

local function serverHop()
    local history = getHistory()
    local now = os.time()
    
    -- Clean old logs
    for id, timestamp in pairs(history) do
        if now - timestamp > LOG_EXPIRY_TIME then history[id] = nil end
    end
    
    -- Log current
    history[game.JobId] = now
    saveHistory(history)

    local success, result = pcall(function()
        return HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
    end)

    if success and result and result.data then
        for _, server in ipairs(result.data) do
            if server.playing < server.maxPlayers and not history[server.id] then
                TeleportService:TeleportToPlaceInstance(game.PlaceId, server.id)
                return
            end
        end
    end
end

-- 5. UI Setup
local Window = syde:Load({
    Name = "Syde Utility",
    Logo = "14554547135",
    ConfigFolder = "SydeConfigs",
    ConfigEnabled = true
})

local Page = Window:CreatePage({ Title = "Main" })

-- 6. The Toggle
local isHopping = false
Page:Toggle({
    Title = "Server Hopper",
    Description = "Hops until target MeshPart is found.",
    Default = false,
    SFlag = "HopToggle",
    CallBack = function(state)
        isHopping = state
        if state then
            task.spawn(function()
                while isHopping do
                    -- Search logic
                    local target = workspace:FindFirstChild("map") 
                        and workspace.map:FindFirstChild("Rokyo") 
                        and workspace.map.Rokyo:FindFirstChild("MeshPart")

                    if target and target.MeshId == MESH_ID_TARGET then
                        print("found")
                        isHopping = false
                        break
                    else
                        print("Not found, hopping...")
                        serverHop()
                    end
                    task.wait(5) -- Safety delay before next attempt/hop
                end
            end)
        end
    end
})

syde:LoadSaveConfig()
